<analysis>**original_problem_statement:**
The user wants to build a full-stack application that converts recipes into weekly shopping lists.

**PRODUCT REQUIREMENTS:**
1.  **Recipe Management**: Allow users to input recipes, which are then parsed by AI. The app should generate AI images, auto-categorize recipes (including Vegan, Vegetarian, Can be Vegan), allow scaling of servings, and group recipes. All instructions must be immediately rewritten by AI to be copyright-safe. Users can edit, rate, and favorite recipes. A new Cocktails section with alcoholic/non-alcoholic filtering has been requested.
2.  **User Accounts & Sharing**: The app must support Google Sign-In. Users can share recipes via private, tokenized links.
3.  **Pantry & Suggestions**: A pantry system to track ingredients with custom alerts. The app suggests meals based on pantry items, can AI-generate new recipes from pantry contents, and supports adding items via barcode scanning or receipt uploads (image/PDF).
4.  **Weekly Planner**: A planner to organize meals. It should allow adjusting servings per meal and have a Surprise Me feature to auto-populate the week.
5.  **Smart Shopping List**: Generates a shopping list from the weekly plan, consolidating items and subtracting pantry ingredients. It should also provide realistic cost estimations.
6.  **UI/UX**: A calm and foody design. UI should be intuitive, with features like clicking a planned meal to get I Cooked It or Go to Recipe options.
7.  **Recipe Conversion**: Buttons within a recipe to automatically convert it to a Vegan or Vegetarian version using AI.

**User's preferred language**: English

**what currently exists?**
A full-stack application using FastAPI, MongoDB, and React with Google OAuth2 authentication. All AI features use the standard usage: openai [-h] [-v] [-b API_BASE] [-k API_KEY] [-p PROXY [PROXY ...]]
              [-o ORGANIZATION] [-t {openai,azure}]
              [--api-version API_VERSION] [--azure-endpoint AZURE_ENDPOINT]
              [--azure-ad-token AZURE_AD_TOKEN] [-V]
              {api,tools,migrate,grit} ...

positional arguments:
  {api,tools,migrate,grit}
    api                 Direct API calls
    tools               Client side tools for convenience

options:
  -h, --help            show this help message and exit
  -v, --verbose         Set verbosity.
  -b API_BASE, --api-base API_BASE
                        What API base url to use.
  -k API_KEY, --api-key API_KEY
                        What API key to use.
  -p PROXY [PROXY ...], --proxy PROXY [PROXY ...]
                        What proxy to use.
  -o ORGANIZATION, --organization ORGANIZATION
                        Which organization to run as (will use your default
                        organization if not specified)
  -t {openai,azure}, --api-type {openai,azure}
                        The backend API to call, must be `openai` or `azure`
  --api-version API_VERSION
                        The Azure API version, e.g.
                        'https://learn.microsoft.com/en-us/azure/ai-
                        services/openai/reference#rest-api-versioning'
  --azure-endpoint AZURE_ENDPOINT
                        The Azure endpoint, e.g.
                        'https://endpoint.openai.azure.com'
  --azure-ad-token AZURE_AD_TOKEN
                        A token from Azure Active Directory,
                        https://www.microsoft.com/en-
                        us/security/business/identity-access/microsoft-entra-
                        id
  -V, --version         show program's version number and exit SDK with a user-provided API key.

The app features a dashboard, recipe library, recipe detail view (with Make Vegan/Vegetarian buttons), an  page, a weekly planner (with servings adjustment and a Surprise Me button), a shopping list (with cost estimation), and a pantry. The pantry supports adding items via receipt upload (now handling multi-page text-based PDFs), barcode scanning (with a fill level prompt), and manual entry. A button to consolidate duplicate pantry items has also been added. Logic for fuzzy matching ingredients has been implemented in several areas to improve accuracy.

The backend  file remains a large monolith, and routing has been re-ordered to fix deployment issues on DigitalOcean.

**Last working item**:
-   Last item agent was working: Implementing a new Cocktails section. The agent started by modifying the backend Pydantic models (, ) in  to include a  (e.g., 'meal', 'cocktail') and an  flag.
-   Status: IN PROGRESS
-   Agent Testing Done: N
-   Which testing method agent to use? both
-   User Testing Done: N

**All Pending/In progress Issue list**:
-   **Issue 1**: Complete the Cocktails feature. (Priority: P0)
-   **Issue 2**: PDF uploads are still reported as failing by the user. (Priority: P1)
-   **Issue 3**: Ingredient consolidation in the pantry is not perfect (e.g., Plant Based Burger vs. Beyond Burger Plant Based Burger are not merging). (Priority: P1)
-   **Issue 4**: I cooked this button doesn't always find matching ingredients in the pantry due to name variations. (Priority: P2)
-   **Issue 5**: The AI-generated meal suggestion filter for expiring soon items is not working as expected. (Priority: P2)
-   **Issue 6**: Meal suggestion filtering for breakfast and lunch is returning dinner meals. (Priority: P2)

**Issues Detail**:
-   **Issue 1**:
    -   **Description**: Add a new Cocktails section to the app, separate from meals, with filters for alcoholic and non-alcoholic.
    -   **Attempted fixes**: The backend data models (, ) in  have been updated to support  and  fields.
    -   **Next debug checklist**:
        1.  Create a new backend endpoint  in  that filters recipes where  and accepts an  query parameter.
        2.  Create a new frontend page .
        3.  Add a link to the new page in the main navigation ().
        4.  On the  page, fetch data from the new endpoint and display the results.
        5.  Add filter UI (e.g., buttons, dropdown) for All, Alcoholic, and Non-Alcoholic.
        6.  Update the  page to allow setting the  to Cocktail and toggling the  flag when adding a new recipe.
    -   **Why fix this issue and what will be achieved with the fix?**: This is a new top-level feature requested by the user.
    -   **Status**: IN PROGRESS
    -   **Is recurring issue?**: N
    -   **Should Test frontend/backend/both after fix?**: both
    -   **Blocked on other issue**: None

-   **Issue 2**:
    -   **Description**: The user reports that PDF uploads for recipes and receipts are still not working.
    -   **Attempted fixes**: The agent implemented robust PDF handling using  to convert PDFs to images or extract text directly, which works for multi-page text-based PDFs. File input  attributes were updated. The backend logic was confirmed to work locally, but fails in the preview environment due to an invalid API key ( is not a valid OpenAI key). The root cause is an environment configuration issue in preview, not a code issue.
    -   **Next debug checklist**:
        1.  Re-confirm with the user that their  is correctly set in their DigitalOcean environment.
        2.  Add more explicit frontend error handling in  and  to display the specific error message from the backend if an upload fails.
        3.  Explain to the user that testing in the preview environment is blocked by the API key issue, but the code is expected to work in their production environment.
    -   **Why fix this issue and what will be achieved with the fix?**: This is a critical usability issue and a recurring point of user frustration.
    -   **Status**: BLOCKED (on environment configuration)
    -   **Is recurring issue?**: Y
    -   **Should Test frontend/backend/both after fix?**: both
    -   **Blocked on other issue**: None

-   **Issue 3**:
    -   **Description**: The pantry consolidation logic isn't catching all duplicates, especially when brand names are involved.
    -   **Attempted fixes**: Fuzzy matching logic was added to the receipt processing flow, and a manual Consolidate Pantry button/endpoint was created.
    -   **Next debug checklist**:
        1.  Review the  function and the logic in  in .
        2.  The matching may need to be more aggressive, potentially using a library like  and stripping common brand names before comparison.
        3.  Improve the AI prompt used for consolidation to be more effective.
    -   **Why fix this issue and what will be achieved with the fix?**: Improves data quality in the pantry, leading to better meal suggestions and shopping list accuracy.
    -   **Status**: IN PROGRESS
    -   **Is recurring issue?**: Y
    -   **Should Test frontend/backend/both after fix?**: backend
    -   **Blocked on other issue**: None

-   **Issue 4**:
    -   **Description**: The I cooked this feature fails to deduct from the pantry when recipe ingredient names don't exactly match pantry item names.
    -   **Attempted fixes**: The  endpoint was updated to use a more intelligent matching logic.
    -   **Next debug checklist**:
        1.  Re-examine the  endpoint in .
        2.  Ensure it uses the same robust  function as other parts of the application.
        3.  Test with specific examples provided by the user.
    -   **Why fix this issue and what will be achieved with the fix?**: Core functionality of the pantry system.
    -   **Status**: IN PROGRESS
    -   **Is recurring issue?**: Y
    -   **Should Test frontend/backend/both after fix?**: backend
    -   **Blocked on other issue**: None

-   **Issue 5**:
    -   **Description**: The AI-generated meal suggestion does not correctly prioritize expiring ingredients when the filter is active.
    -   **Attempted fixes**: The agent added an  boolean to the  Pydantic model and updated the frontend to pass this flag.
    -   **Next debug checklist**:
        1.  Verify the prompt engineering in the  endpoint in . The prompt must strongly instruct the AI to use the provided expiring ingredients.
        2.  Test the frontend component  to ensure the state  is correctly passed in the API call.
    -   **Why fix this issue and what will be achieved with the fix?**: Fulfills a key value proposition of reducing food waste.
    -   **Status**: IN PROGRESS
    -   **Is recurring issue?**: N
    -   **Should Test frontend/backend/both after fix?**: both
    -   **Blocked on other issue**: None

-   **Issue 6**:
    -   **Description**: Filtering meal suggestions by breakfast or lunch returns dinner meals.
    -   **Attempted fixes**: The agent discovered that recipes were not being tagged with a  on creation. A fix was implemented to rely on more robust keyword-based filtering in  instead of querying a non-existent field.
    -   **Next debug checklist**:
        1.  Review the keyword lists (, , etc.) in  to ensure they are comprehensive.
        2.  Test the  endpoint with various  parameters to verify the filtering logic.
    -   **Why fix this issue and what will be achieved with the fix?**: Improves the user experience of finding relevant meal suggestions.
    -   **Status**: IN PROGRESS
    -   **Is recurring issue?**: N
    -   **Should Test frontend/backend/both after fix?**: backend
    -   **Blocked on other issue**: None

**In progress Task List**:
-   **Task 1**: Implement the Cocktails feature. (Priority: P0)
    -   **Where to resume**: . The next step is to create the  endpoint.
    -   **What will be achieved with this?**: A new, filterable section for cocktail recipes.
    -   **Status**: IN PROGRESS
    -   **Should Test frontend/backend/both after fix?**: both
    -   **Blocked on something**: None

**Upcoming and Future Tasks**
-   **Upcoming Tasks**:
    -   **P0**: Propose and execute the refactoring of the monolithic  file. This is the highest priority technical debt and is slowing down all development.
    -   **P1**: Conduct a full end-to-end test of all recently added features (Planner serving adjustment, Surprise Me, Barcode scanning, Pantry consolidation, Meal click actions).
-   **Future Tasks**:
    -   **P1**: Drag-and-Drop functionality for the Weekly Planner UI.
    -   **P2**: Integration with Whisk.com for add to basket functionality.
    -   **P2**: Push notifications or email summaries for expiring pantry items.

**Completed work in this session**
-   **Feature: Make Vegan/Vegetarian**: Completed the UI and backend logic for AI-powered recipe conversion.
-   **Bugfix: DigitalOcean Blank Page**: Fixed a critical deployment blocker by reordering API router inclusion before static file serving in .
-   **Feature: Advanced PDF Receipt Scanning**: Rewrote the receipt scanning logic to use  for direct text extraction from multi-page, text-based PDFs (like the user's Tesco basket).
-   **Feature: Planner Enhancements**:
    -   Added the ability to adjust servings when adding a recipe to the planner.
    -   Added a Surprise Me button to auto-populate the weekly plan.
    -   Made meal cards in the planner clickable, showing a dialog with I Cooked It and Go to Recipe options.
-   **Feature: Pantry Barcode Scanning**: Implemented barcode scanning using  and an Open Food Facts API lookup on the backend. Includes a prompt for item fill level (Full, Half, Empty) to adjust quantity.
-   **Feature: Pantry Consolidation**: Added a Consolidate button and endpoint to merge duplicate items in the pantry.
-   **Bugfix: Unrealistic Price Estimation**: Fixed the cost estimation logic to correctly calculate prices for fractional quantities instead of rounding up, making prices much more realistic.
-   **Bugfix: Ingredient Matching**: Improved fuzzy matching logic in I Cooked This and Meal Suggestion features to better match ingredients with slight name variations.
-   **Dependency Management**: Removed the defunct  package from  and added .

**Earlier issues found/mentioned but not fixed**
-   **Issue 1: Monolithic Backend ()**: This is the project's most significant technical debt. The file is now extremely large (>4500 lines) and difficult to maintain. It urgently needs to be refactored into a modular structure (, , ).
-   **Issue 2: Unused Files**: The root directory may still contain unused deployment helper files (, ) which should be removed.

**Known issue recurrence from previous fork**
-   **Fuzzy String Matching**: The user has repeatedly encountered issues where slight variations in ingredient names cause features to fail (pantry consolidation, meal suggestions, pantry deduction). While several fixes have been applied, this remains a systemic challenge requiring a robust, centralized solution.
-   **PDF Uploads**: The user has reported this as broken multiple times. The agent has diagnosed it as an environment-specific API key issue, but from the user's perspective, it is a recurring failure.

**Code Architecture**


**Key Technical Concepts**
-   **Backend**: FastAPI, Motor (async MongoDB), Pydantic.
-   **Frontend**: React, React Router, Tailwind CSS, Shadcn UI, , .
-   **AI**: **OpenAI SDK (usage: openai [-h] [-v] [-b API_BASE] [-k API_KEY] [-p PROXY [PROXY ...]]
              [-o ORGANIZATION] [-t {openai,azure}]
              [--api-version API_VERSION] [--azure-endpoint AZURE_ENDPOINT]
              [--azure-ad-token AZURE_AD_TOKEN] [-V]
              {api,tools,migrate,grit} ...

positional arguments:
  {api,tools,migrate,grit}
    api                 Direct API calls
    tools               Client side tools for convenience

options:
  -h, --help            show this help message and exit
  -v, --verbose         Set verbosity.
  -b API_BASE, --api-base API_BASE
                        What API base url to use.
  -k API_KEY, --api-key API_KEY
                        What API key to use.
  -p PROXY [PROXY ...], --proxy PROXY [PROXY ...]
                        What proxy to use.
  -o ORGANIZATION, --organization ORGANIZATION
                        Which organization to run as (will use your default
                        organization if not specified)
  -t {openai,azure}, --api-type {openai,azure}
                        The backend API to call, must be `openai` or `azure`
  --api-version API_VERSION
                        The Azure API version, e.g.
                        'https://learn.microsoft.com/en-us/azure/ai-
                        services/openai/reference#rest-api-versioning'
  --azure-endpoint AZURE_ENDPOINT
                        The Azure endpoint, e.g.
                        'https://endpoint.openai.azure.com'
  --azure-ad-token AZURE_AD_TOKEN
                        A token from Azure Active Directory,
                        https://www.microsoft.com/en-
                        us/security/business/identity-access/microsoft-entra-
                        id
  -V, --version         show program's version number and exit)** for all AI features (GPT-4o, DALL-E).
-   **PDF Processing**:  library for extracting text and images from PDF files.
-   **Barcode Scanning**: Open Food Facts API for product lookup.

**key DB schema**
-   **recipes**:  (New fields added).
-   **pantry_items**: 
-   **users**: 

**changes in tech stack**
-   **ADDED**:  (backend),  (frontend).

**All files of reference**
-   : Heavily modified for all new features and bug fixes.
-   : Major refactor for new planner features.
-   : Major refactor for barcode scanning and consolidation.
-   : Updated for filter fixes.
-   : Updated to allow PDF uploads.
-   : Updated with several new endpoints.
-   : Updated with new dependencies.
-   : Updated with new dependencies.

**Areas that need refactoring**:
-   ** MUST BE BROKEN DOWN.** This is the highest priority refactoring task. Its size and complexity are a major risk to future development.

**key api endpoints**
-   : (New) Merges duplicate items in the pantry.
-   : (New) Looks up a product by its barcode.
-   : (Updated) Now handles multi-page text-based PDFs.
-   : (Updated) Now handles PDFs by converting them to images.
-   : (Updated) Now accepts an  filter.
-   : (Updated) Uses fuzzy matching to deduct ingredients.

**Critical Info for New Agent**
-   **OpenAI API Key is Essential**: The preview environment uses a non-functional Emergent placeholder key () for the  variable. This causes all OpenAI-dependent features (parsing, generation, etc.) to fail with a 401 error in preview. The code itself is correct and relies on a valid key, which the user has configured in their production DigitalOcean environment. You must explain this to the user and not mistake it for a code bug.
-   **Fuzzy Matching is a Core Problem**: Many user-reported bugs stem from inexact string matching of ingredients. A robust, centralized fuzzy matching utility is needed across the application (pantry, shopping list, meal suggestions).
-   **Prioritize Backend Refactor**: You must strongly advocate for refactoring the  monolith after completing the current high-priority user requests. It is a major source of risk and development friction.

**documents and test reports created in this job**
-    (updated with Make Vegan feature)

**Last 10 User Messages and any pending HUMAN messages**
1.  **user**: Can you add recipes for cocktails, similar to meals but with filters, alcoholic and non-alcoholic. (IN PROGRESS)
2.  **user**: When a meal is selected in planner, clicking it should give options I cooked it or take me to recipe. (RESOLVED)
3.  **user**: Pantry items are not consolidating correctly (e.g., two types of plant-based burgers are separate). (IN PROGRESS - fix attempted)
4.  **user**: Can I scan barcodes of food items to upload to the pantry? (RESOLVED - feature added)
5.  **user**: After scanning a barcode, can you add a prompt for full, half, nearly empty to calculate quantity? (RESOLVED - feature added)
6.  **user**: Prices are unrealistic. (RESOLVED - fix implemented and verified)
7.  **user**: Filter for breakfast and lunch is returning dinner meals. (RESOLVED - fix implemented)
8.  **user**: Meal suggestions have low % likeness even with items in pantry. (RESOLVED - fuzzy matching improved)
9.  **user**: The I cooked this button doesn't use up pantry ingredients with slightly different names. (IN PROGRESS - fix attempted)
10. **user**: The AI-generated meal suggestion doesn't consider expiry dates when the filter is on. (IN PROGRESS - fix attempted)

**Project Health Check:**
-   **Broken**: None.
-   **Mocked**: None.
-   **Fragile**: The backend is extremely fragile due to the monolithic . Changes have a high risk of unintended side effects.

**3rd Party Integrations**
-   **OpenAI SDK (usage: openai [-h] [-v] [-b API_BASE] [-k API_KEY] [-p PROXY [PROXY ...]]
              [-o ORGANIZATION] [-t {openai,azure}]
              [--api-version API_VERSION] [--azure-endpoint AZURE_ENDPOINT]
              [--azure-ad-token AZURE_AD_TOKEN] [-V]
              {api,tools,migrate,grit} ...

positional arguments:
  {api,tools,migrate,grit}
    api                 Direct API calls
    tools               Client side tools for convenience

options:
  -h, --help            show this help message and exit
  -v, --verbose         Set verbosity.
  -b API_BASE, --api-base API_BASE
                        What API base url to use.
  -k API_KEY, --api-key API_KEY
                        What API key to use.
  -p PROXY [PROXY ...], --proxy PROXY [PROXY ...]
                        What proxy to use.
  -o ORGANIZATION, --organization ORGANIZATION
                        Which organization to run as (will use your default
                        organization if not specified)
  -t {openai,azure}, --api-type {openai,azure}
                        The backend API to call, must be `openai` or `azure`
  --api-version API_VERSION
                        The Azure API version, e.g.
                        'https://learn.microsoft.com/en-us/azure/ai-
                        services/openai/reference#rest-api-versioning'
  --azure-endpoint AZURE_ENDPOINT
                        The Azure endpoint, e.g.
                        'https://endpoint.openai.azure.com'
  --azure-ad-token AZURE_AD_TOKEN
                        A token from Azure Active Directory,
                        https://www.microsoft.com/en-
                        us/security/business/identity-access/microsoft-entra-
                        id
  -V, --version         show program's version number and exit)**: Requires User-provided .
-   **Google OAuth 2.0**: Requires User-provided Google credentials.
-   **Open Food Facts API**: Used for barcode lookup (no key required).

**Testing status**
-   **Testing agent used after significant changes**: NO (not for the latest large batch of features).
-   **Troubleshoot agent used after agent stuck in loop**: NO
-   **Test files created**: Yes, temporary test scripts were created and deleted to validate PDF processing and API endpoints. No permanent test files exist.
-   **Known regressions**: None confirmed, but the risk is high given the extensive changes and lack of automated tests.

**Credentials to test flow:**
-   A valid  is required for full application functionality. Testing in the preview environment will be limited.

**What agent forgot to execute**
-   The critical refactoring of  has been deferred again.
-   Unused files in the root directory (, ) have not been cleaned up.
-   No permanent automated tests (============================= test session starts ==============================
platform linux -- Python 3.11.14, pytest-9.0.2, pluggy-1.6.0
rootdir: /app
plugins: anyio-4.12.1
collected 97 items

backend/tests/test_expiry_features.py .............                      [ 13%]
backend/tests/test_expiry_receipt.py .....F.....                         [ 24%]
backend/tests/test_features_iteration5.py FFFFFFFFFF                     [ 35%]
backend/tests/test_iteration11_features.py FFFFFFFFFFFFFF                [ 49%]
backend/tests/test_iteration12_critical_fixes.py FFFFFFFFFF              [ 59%]
backend/tests/test_pantry_features.py FFFFFFFF                           [ 68%]
backend/tests/test_parse_image.py FFFFFF                                 [ 74%]
backend/tests/test_reviews_and_sorting.py FFFFFFFFFFFFFF                 [ 88%]
backend/tests/test_share_feature.py .....F.....                          [100%]

=================================== FAILURES ===================================
____________ TestReceiptScanning.test_scan_receipt_endpoint_exists _____________

self = <test_expiry_receipt.TestReceiptScanning object at 0xfc1e5c7063d0>
api_client = <requests.sessions.Session object at 0xfc1e5c732990>

    def test_scan_receipt_endpoint_exists(self, api_client):
        """Test that POST /api/pantry/scan-receipt endpoint exists"""
        # Create a simple test image (1x1 white pixel PNG)
        import base64
        # Minimal valid PNG (1x1 white pixel)
        png_data = base64.b64decode(
            "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg=="
        )
    
        files = {"file": ("test_receipt.png", png_data, "image/png")}
    
        # Remove Content-Type header for multipart
        headers = {"Authorization": f"Bearer {SESSION_TOKEN}"}
    
        response = requests.post(
            f"{BASE_URL}/api/pantry/scan-receipt",
            files=files,
            headers=headers
        )
    
        # Should return 200 (even if no items found) or 503 if AI not available
>       assert response.status_code in [200, 503], f"Expected 200 or 503, got {response.status_code}: {response.text}"
E       AssertionError: Expected 200 or 503, got 520: {"detail":"Error processing receipt: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-emerg******************8863. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'code': 'invalid_api_key', 'param': None}, 'status': 401}"}
E       assert 520 in [200, 503]
E        +  where 520 = <Response [520]>.status_code

backend/tests/test_expiry_receipt.py:138: AssertionError
__________ TestRecipeCategoriesAPI.test_create_recipe_with_categories __________

self = <test_features_iteration5.TestRecipeCategoriesAPI object at 0xfc1e5c6daa10>

    def test_create_recipe_with_categories(self):
        """Test creating a recipe with categories"""
        recipe_data = {
            "name": f"TEST_Category_Recipe_{uuid.uuid4().hex[:8]}",
            "description": "Test recipe for category testing",
            "servings": 4,
            "ingredients": [
                {"name": "tofu", "quantity": "1", "unit": "block", "category": "protein"},
                {"name": "broccoli", "quantity": "2", "unit": "cups", "category": "produce"}
            ],
            "instructions": ["Step 1", "Step 2"],
            "categories": ["vegan", "quick-easy"]
        }
    
>       response = requests.post(f"{BASE_URL}/api/recipes", json=recipe_data)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_features_iteration5.py:43: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:115: in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/recipes', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes': No scheme supplied. Perhaps you meant https:///api/recipes?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
____________ TestRecipeCategoriesAPI.test_update_recipe_categories _____________

self = <test_features_iteration5.TestRecipeCategoriesAPI object at 0xfc1e5c6db010>

    def test_update_recipe_categories(self):
        """Test updating recipe categories via PUT endpoint"""
        # First create a recipe
        recipe_data = {
            "name": f"TEST_Update_Categories_{uuid.uuid4().hex[:8]}",
            "description": "Test recipe for category update",
            "servings": 2,
            "ingredients": [
                {"name": "chicken", "quantity": "1", "unit": "lb", "category": "protein"}
            ],
            "instructions": ["Cook it"],
            "categories": []
        }
    
>       create_response = requests.post(f"{BASE_URL}/api/recipes", json=recipe_data)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_features_iteration5.py:69: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:115: in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/recipes', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes': No scheme supplied. Perhaps you meant https:///api/recipes?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
__________ TestRecipeCategoriesAPI.test_update_categories_remove_all ___________

self = <test_features_iteration5.TestRecipeCategoriesAPI object at 0xfc1e5c706c90>

    def test_update_categories_remove_all(self):
        """Test removing all categories from a recipe"""
        # Create recipe with categories
        recipe_data = {
            "name": f"TEST_Remove_Categories_{uuid.uuid4().hex[:8]}",
            "servings": 2,
            "ingredients": [{"name": "rice", "quantity": "1", "unit": "cup", "category": "grains"}],
            "instructions": ["Cook"],
            "categories": ["vegan", "vegetarian"]
        }
    
>       create_response = requests.post(f"{BASE_URL}/api/recipes", json=recipe_data)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_features_iteration5.py:106: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:115: in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/recipes', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes': No scheme supplied. Perhaps you meant https:///api/recipes?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
________ TestRecipeCategoriesAPI.test_update_categories_invalid_recipe _________

self = <test_features_iteration5.TestRecipeCategoriesAPI object at 0xfc1e5c704810>

    def test_update_categories_invalid_recipe(self):
        """Test updating categories for non-existent recipe"""
        fake_id = "non-existent-recipe-id"
>       update_response = requests.put(f"{BASE_URL}/api/recipes/{fake_id}/categories", json={"categories": ["vegan"]})
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_features_iteration5.py:122: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:130: in put
    return request("put", url, data=data, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [PUT]>
url = '/api/recipes/non-existent-recipe-id/categories', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes/non-existent-recipe-id/categories': No scheme supplied. Perhaps you meant https:///api/recipes/non-existent-recipe-id/categories?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
______________ TestPantryCookAPI.test_cook_recipe_deducts_pantry _______________

self = <test_features_iteration5.TestPantryCookAPI object at 0xfc1e5c6dad90>

    def test_cook_recipe_deducts_pantry(self):
        """Test that cooking a recipe deducts ingredients from pantry"""
        # First add items to pantry
        pantry_item = {
            "name": "TEST_Chicken",
            "quantity": 5,
            "unit": "lb",
            "category": "protein"
        }
>       add_response = requests.post(f"{BASE_URL}/api/pantry/items", json=pantry_item)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_features_iteration5.py:153: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:115: in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/pantry/items'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/pantry/items': No scheme supplied. Perhaps you meant https:///api/pantry/items?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_________ TestPantryCookAPI.test_cook_recipe_with_missing_ingredients __________

self = <test_features_iteration5.TestPantryCookAPI object at 0xfc1e5c6dbad0>

    def test_cook_recipe_with_missing_ingredients(self):
        """Test cooking a recipe when some ingredients are not in pantry"""
        # Create a recipe with ingredients not in pantry
        recipe_data = {
            "name": f"TEST_Missing_Ingredients_{uuid.uuid4().hex[:8]}",
            "servings": 2,
            "ingredients": [
                {"name": "UNIQUE_INGREDIENT_NOT_IN_PANTRY", "quantity": "1", "unit": "cup", "category": "other"}
            ],
            "instructions": ["Mix it"]
        }
    
>       create_response = requests.post(f"{BASE_URL}/api/recipes", json=recipe_data)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_features_iteration5.py:204: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:115: in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/recipes', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes': No scheme supplied. Perhaps you meant https:///api/recipes?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_________________ TestPantryCookAPI.test_cook_recipe_not_found _________________

self = <test_features_iteration5.TestPantryCookAPI object at 0xfc1e5c6dbf10>

    def test_cook_recipe_not_found(self):
        """Test cooking a non-existent recipe"""
>       cook_response = requests.post(f"{BASE_URL}/api/pantry/cook", json={"recipe_id": "non-existent-id", "servings_multiplier": 1})
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_features_iteration5.py:222: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:115: in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/pantry/cook'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/pantry/cook': No scheme supplied. Perhaps you meant https:///api/pantry/cook?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_________ TestPantryCookAPI.test_cook_recipe_with_servings_multiplier __________

self = <test_features_iteration5.TestPantryCookAPI object at 0xfc1e5c6e4710>

    def test_cook_recipe_with_servings_multiplier(self):
        """Test cooking with different servings multiplier"""
        # Add pantry item
        pantry_item = {
            "name": "TEST_Flour",
            "quantity": 10,
            "unit": "cups",
            "category": "pantry"
        }
>       requests.post(f"{BASE_URL}/api/pantry/items", json=pantry_item)

backend/tests/test_features_iteration5.py:236: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:115: in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/pantry/items'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/pantry/items': No scheme supplied. Perhaps you meant https:///api/pantry/items?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
________ TestRecipeFilterByCategory.test_recipes_have_categories_field _________

self = <test_features_iteration5.TestRecipeFilterByCategory object at 0xfc1e5c6e4490>

    def test_recipes_have_categories_field(self):
        """Test that recipes endpoint returns categories field"""
>       response = requests.get(f"{BASE_URL}/api/recipes")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_features_iteration5.py:285: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:73: in get
    return request("get", url, params=params, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/recipes', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes': No scheme supplied. Perhaps you meant https:///api/recipes?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
___ TestRecipeFilterByCategory.test_create_recipes_with_different_categories ___

self = <test_features_iteration5.TestRecipeFilterByCategory object at 0xfc1e5c6e5210>

    def test_create_recipes_with_different_categories(self):
        """Test creating recipes with different categories for filter testing"""
        # Create vegan recipe
        vegan_recipe = {
            "name": f"TEST_Vegan_Recipe_{uuid.uuid4().hex[:8]}",
            "servings": 2,
            "ingredients": [{"name": "tofu", "quantity": "1", "unit": "block", "category": "protein"}],
            "instructions": ["Cook"],
            "categories": ["vegan"]
        }
    
>       response1 = requests.post(f"{BASE_URL}/api/recipes", json=vegan_recipe)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_features_iteration5.py:309: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:115: in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/recipes', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes': No scheme supplied. Perhaps you meant https:///api/recipes?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
____________________ TestAuthAndBasicEndpoints.test_auth_me ____________________

self = <test_iteration11_features.TestAuthAndBasicEndpoints object at 0xfc1e5c6e7ad0>
api_client = <requests.sessions.Session object at 0xfc1e5b9a4250>

    def test_auth_me(self, api_client):
        """Test /api/auth/me returns user data"""
>       response = api_client.get(f"{BASE_URL}/api/auth/me")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration11_features.py:39: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/auth/me', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/auth/me': No scheme supplied. Perhaps you meant https:///api/auth/me?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
___________________ TestAuthAndBasicEndpoints.test_api_root ____________________

self = <test_iteration11_features.TestAuthAndBasicEndpoints object at 0xfc1e5c6cb550>
api_client = <requests.sessions.Session object at 0xfc1e5b9a4190>

    def test_api_root(self, api_client):
        """Test API root endpoint"""
>       response = api_client.get(f"{BASE_URL}/api/")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration11_features.py:48: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/': No scheme supplied. Perhaps you meant https:///api/?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_ TestMealSuggestionsRelatedRecipeCount.test_suggestions_endpoint_returns_related_recipe_count _

self = <test_iteration11_features.TestMealSuggestionsRelatedRecipeCount object at 0xfc1e5c6cad90>
api_client = <requests.sessions.Session object at 0xfc1e5ba3dc90>

    def test_suggestions_endpoint_returns_related_recipe_count(self, api_client):
        """Test /api/suggestions/meals returns related_recipe_count field"""
>       response = api_client.get(f"{BASE_URL}/api/suggestions/meals")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration11_features.py:60: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/suggestions/meals'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/suggestions/meals': No scheme supplied. Perhaps you meant https:///api/suggestions/meals?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_ TestMealSuggestionsRelatedRecipeCount.test_suggestions_with_expiring_filter __

self = <test_iteration11_features.TestMealSuggestionsRelatedRecipeCount object at 0xfc1e5c6cbad0>
api_client = <requests.sessions.Session object at 0xfc1e5b9caa10>

    def test_suggestions_with_expiring_filter(self, api_client):
        """Test /api/suggestions/meals?expiring_soon=true"""
>       response = api_client.get(f"{BASE_URL}/api/suggestions/meals?expiring_soon=true")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration11_features.py:77: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>
url = '/api/suggestions/meals?expiring_soon=true', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/suggestions/meals?expiring_soon=true': No scheme supplied. Perhaps you meant https:///api/suggestions/meals?expiring_soon=true?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
______ TestRecipeCreationWithImageChoice.test_create_recipe_with_ai_image ______

self = <test_iteration11_features.TestRecipeCreationWithImageChoice object at 0xfc1e5c6c8690>
api_client = <requests.sessions.Session object at 0xfc1e5b8cafd0>

    def test_create_recipe_with_ai_image(self, api_client):
        """Test creating recipe with AI image generation (skip_image_generation=false)"""
        recipe_data = {
            "name": "TEST_AI_Image_Recipe",
            "description": "Test recipe for AI image",
            "servings": 2,
            "prep_time": "10 min",
            "cook_time": "20 min",
            "ingredients": [
                {"name": "chicken breast", "quantity": "2", "unit": "pieces"},
                {"name": "olive oil", "quantity": "2", "unit": "tbsp"}
            ],
            "instructions": ["Step 1", "Step 2"],
            "skip_image_generation": False  # AI should generate image
        }
    
>       response = api_client.post(f"{BASE_URL}/api/recipes", json=recipe_data)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration11_features.py:109: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:637: in post
    return self.request("POST", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/recipes', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes': No scheme supplied. Perhaps you meant https:///api/recipes?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
______ TestRecipeCreationWithImageChoice.test_create_recipe_with_no_image ______

self = <test_iteration11_features.TestRecipeCreationWithImageChoice object at 0xfc1e5c6c8b10>
api_client = <requests.sessions.Session object at 0xfc1e5ba6bdd0>

    def test_create_recipe_with_no_image(self, api_client):
        """Test creating recipe with no image (skip_image_generation=true)"""
        recipe_data = {
            "name": "TEST_No_Image_Recipe",
            "description": "Test recipe without image",
            "servings": 2,
            "prep_time": "5 min",
            "cook_time": "10 min",
            "ingredients": [
                {"name": "pasta", "quantity": "200", "unit": "g"}
            ],
            "instructions": ["Boil pasta"],
            "skip_image_generation": True,  # No AI image
            "image_url": ""  # Explicitly no image
        }
    
>       response = api_client.post(f"{BASE_URL}/api/recipes", json=recipe_data)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration11_features.py:147: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:637: in post
    return self.request("POST", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/recipes', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes': No scheme supplied. Perhaps you meant https:///api/recipes?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
__ TestRecipeCreationWithImageChoice.test_create_recipe_with_own_base64_image __

self = <test_iteration11_features.TestRecipeCreationWithImageChoice object at 0xfc1e5c6db9d0>
api_client = <requests.sessions.Session object at 0xfc1e5ba1fcd0>

    def test_create_recipe_with_own_base64_image(self, api_client):
        """Test creating recipe with user's own base64 image"""
        # Small test base64 image (1x1 pixel PNG)
        test_base64_image = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg=="
    
        recipe_data = {
            "name": "TEST_Own_Image_Recipe",
            "description": "Test recipe with own image",
            "servings": 2,
            "prep_time": "5 min",
            "cook_time": "10 min",
            "ingredients": [
                {"name": "rice", "quantity": "1", "unit": "cup"}
            ],
            "instructions": ["Cook rice"],
            "skip_image_generation": True,  # Don't generate AI image
            "image_url": test_base64_image  # User's own base64 image
        }
    
>       response = api_client.post(f"{BASE_URL}/api/recipes", json=recipe_data)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration11_features.py:178: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:637: in post
    return self.request("POST", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/recipes', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes': No scheme supplied. Perhaps you meant https:///api/recipes?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
____________ TestWeeklyPlannerSuggestions.test_get_recipes_grouped _____________

self = <test_iteration11_features.TestWeeklyPlannerSuggestions object at 0xfc1e5c6cb1d0>
api_client = <requests.sessions.Session object at 0xfc1e5b97f490>

    def test_get_recipes_grouped(self, api_client):
        """Test /api/recipes/grouped endpoint"""
>       response = api_client.get(f"{BASE_URL}/api/recipes/grouped")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration11_features.py:196: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/recipes/grouped'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes/grouped': No scheme supplied. Perhaps you meant https:///api/recipes/grouped?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
______________ TestWeeklyPlannerSuggestions.test_weekly_plan_crud ______________

self = <test_iteration11_features.TestWeeklyPlannerSuggestions object at 0xfc1e5c6c8e90>
api_client = <requests.sessions.Session object at 0xfc1e5c732050>

    def test_weekly_plan_crud(self, api_client):
        """Test weekly plan save and retrieve"""
        # Get current week start
        from datetime import date
        today = date.today()
        week_start = today - timedelta(days=today.weekday())
        week_start_str = week_start.isoformat()
    
        # Get weekly plan
>       response = api_client.get(f"{BASE_URL}/api/weekly-plan?week_start={week_start_str}")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration11_features.py:214: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/weekly-plan?week_start=2026-02-09'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/weekly-plan?week_start=2026-02-09': No scheme supplied. Perhaps you meant https:///api/weekly-plan?week_start=2026-02-09?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_________ TestRecipeLibraryImages.test_get_recipes_returns_image_urls __________

self = <test_iteration11_features.TestRecipeLibraryImages object at 0xfc1e5c6c9390>
api_client = <requests.sessions.Session object at 0xfc1e5ba51110>

    def test_get_recipes_returns_image_urls(self, api_client):
        """Test that recipes have image_url field"""
>       response = api_client.get(f"{BASE_URL}/api/recipes")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration11_features.py:225: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/recipes', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes': No scheme supplied. Perhaps you meant https:///api/recipes?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
________________ TestPantryExpiringItems.test_get_expiring_soon ________________

self = <test_iteration11_features.TestPantryExpiringItems object at 0xfc1e5c6c95d0>
api_client = <requests.sessions.Session object at 0xfc1e5b960690>

    def test_get_expiring_soon(self, api_client):
        """Test /api/pantry/expiring-soon endpoint"""
>       response = api_client.get(f"{BASE_URL}/api/pantry/expiring-soon")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration11_features.py:248: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/pantry/expiring-soon'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/pantry/expiring-soon': No scheme supplied. Perhaps you meant https:///api/pantry/expiring-soon?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
___________ TestPantryExpiringItems.test_add_pantry_item_with_expiry ___________

self = <test_iteration11_features.TestPantryExpiringItems object at 0xfc1e5c6ca0d0>
api_client = <requests.sessions.Session object at 0xfc1e5b926c50>

    def test_add_pantry_item_with_expiry(self, api_client):
        """Test adding pantry item with expiry date"""
        # Add item expiring in 3 days
        expiry_date = (datetime.now() + timedelta(days=3)).isoformat()
    
        item_data = {
            "name": "TEST_Expiring_Milk",
            "quantity": 1,
            "unit": "liter",
            "category": "dairy",
            "expiry_date": expiry_date
        }
    
>       response = api_client.post(f"{BASE_URL}/api/pantry/items", json=item_data)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration11_features.py:269: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:637: in post
    return self.request("POST", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/pantry/items'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/pantry/items': No scheme supplied. Perhaps you meant https:///api/pantry/items?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_______ TestRecipeImportImageConversion.test_scrape_recipe_url_endpoint ________

self = <test_iteration11_features.TestRecipeImportImageConversion object at 0xfc1e5c6c9d90>
api_client = <requests.sessions.Session object at 0xfc1e5c732b90>

    def test_scrape_recipe_url_endpoint(self, api_client):
        """Test /api/recipes/scrape-url endpoint exists"""
        # Just test the endpoint exists and returns proper error for invalid URL
>       response = api_client.post(f"{BASE_URL}/api/recipes/scrape-url", json={"url": "https://invalid-url-test.com"})
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration11_features.py:299: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:637: in post
    return self.request("POST", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/recipes/scrape-url'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes/scrape-url': No scheme supplied. Perhaps you meant https:///api/recipes/scrape-url?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_____ TestCompositeScoreCalculation.test_suggestions_have_composite_score ______

self = <test_iteration11_features.TestCompositeScoreCalculation object at 0xfc1e5c809550>
api_client = <requests.sessions.Session object at 0xfc1e5b8d04d0>

    def test_suggestions_have_composite_score(self, api_client):
        """Test that suggestions include composite_score field"""
>       response = api_client.get(f"{BASE_URL}/api/suggestions/meals")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration11_features.py:310: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/suggestions/meals'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/suggestions/meals': No scheme supplied. Perhaps you meant https:///api/suggestions/meals?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
__________ TestRecipeGroupingAPI.test_recipes_grouped_endpoint_exists __________

self = <test_iteration12_critical_fixes.TestRecipeGroupingAPI object at 0xfc1e5c809a10>

    def test_recipes_grouped_endpoint_exists(self):
        """Test that the grouped endpoint exists and returns 200"""
>       response = requests.get(f"{BASE_URL}/api/recipes/grouped")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration12_critical_fixes.py:18: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:73: in get
    return request("get", url, params=params, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/recipes/grouped'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes/grouped': No scheme supplied. Perhaps you meant https:///api/recipes/grouped?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
________ TestRecipeGroupingAPI.test_recipes_grouped_response_structure _________

self = <test_iteration12_critical_fixes.TestRecipeGroupingAPI object at 0xfc1e5c80a210>

    def test_recipes_grouped_response_structure(self):
        """Test that response has correct structure"""
>       response = requests.get(f"{BASE_URL}/api/recipes/grouped")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration12_critical_fixes.py:24: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:73: in get
    return request("get", url, params=params, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/recipes/grouped'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes/grouped': No scheme supplied. Perhaps you meant https:///api/recipes/grouped?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
____________ TestRecipeGroupingAPI.test_recipes_grouped_count_field ____________

self = <test_iteration12_critical_fixes.TestRecipeGroupingAPI object at 0xfc1e5c80a650>

    def test_recipes_grouped_count_field(self):
        """CRITICAL: Each group must have count >= 2 (sharing 2+ ingredients)"""
>       response = requests.get(f"{BASE_URL}/api/recipes/grouped")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration12_critical_fixes.py:35: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:73: in get
    return request("get", url, params=params, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/recipes/grouped'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes/grouped': No scheme supplied. Perhaps you meant https:///api/recipes/grouped?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_________ TestRecipeGroupingAPI.test_recipes_grouped_recipe_structure __________

self = <test_iteration12_critical_fixes.TestRecipeGroupingAPI object at 0xfc1e5c80acd0>

    def test_recipes_grouped_recipe_structure(self):
        """Test that each recipe in a group has id and name"""
>       response = requests.get(f"{BASE_URL}/api/recipes/grouped")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration12_critical_fixes.py:53: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:73: in get
    return request("get", url, params=params, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/recipes/grouped'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes/grouped': No scheme supplied. Perhaps you meant https:///api/recipes/grouped?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
______ TestRecipeCreationWithImageChoice.test_create_recipe_with_ai_image ______

self = <test_iteration12_critical_fixes.TestRecipeCreationWithImageChoice object at 0xfc1e5c80b390>

    def test_create_recipe_with_ai_image(self):
        """Test creating recipe with AI image generation (skip_image_generation=False)"""
        recipe_data = {
            "name": "TEST_AI_Image_Recipe",
            "description": "Test recipe for AI image generation",
            "servings": 2,
            "ingredients": [
                {"name": "chicken", "quantity": "1", "unit": "lb", "category": "protein"},
                {"name": "garlic", "quantity": "3", "unit": "cloves", "category": "produce"}
            ],
            "instructions": ["Cook chicken", "Add garlic"],
            "skip_image_generation": False  # Should generate AI image
        }
    
>       response = requests.post(f"{BASE_URL}/api/recipes", json=recipe_data)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration12_critical_fixes.py:85: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:115: in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/recipes', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes': No scheme supplied. Perhaps you meant https:///api/recipes?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
______ TestRecipeCreationWithImageChoice.test_create_recipe_without_image ______

self = <test_iteration12_critical_fixes.TestRecipeCreationWithImageChoice object at 0xfc1e5c80bed0>

    def test_create_recipe_without_image(self):
        """Test creating recipe with no image (skip_image_generation=True)"""
        recipe_data = {
            "name": "TEST_No_Image_Recipe",
            "description": "Test recipe without image",
            "servings": 2,
            "ingredients": [
                {"name": "pasta", "quantity": "1", "unit": "lb", "category": "grains"}
            ],
            "instructions": ["Cook pasta"],
            "skip_image_generation": True  # Should NOT generate AI image
        }
    
>       response = requests.post(f"{BASE_URL}/api/recipes", json=recipe_data)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration12_critical_fixes.py:115: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:115: in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/recipes', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes': No scheme supplied. Perhaps you meant https:///api/recipes?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_____ TestRecipeCreationWithImageChoice.test_create_recipe_with_own_image ______

self = <test_iteration12_critical_fixes.TestRecipeCreationWithImageChoice object at 0xfc1e5c6aa350>

    def test_create_recipe_with_own_image(self):
        """Test creating recipe with user's own image (base64)"""
        # Small test base64 image (1x1 pixel PNG)
        test_base64_image = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg=="
    
        recipe_data = {
            "name": "TEST_Own_Image_Recipe",
            "description": "Test recipe with own image",
            "servings": 2,
            "ingredients": [
                {"name": "rice", "quantity": "1", "unit": "cup", "category": "grains"}
            ],
            "instructions": ["Cook rice"],
            "image_url": test_base64_image,
            "skip_image_generation": True
        }
    
>       response = requests.post(f"{BASE_URL}/api/recipes", json=recipe_data)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration12_critical_fixes.py:144: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:115: in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/recipes', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes': No scheme supplied. Perhaps you meant https:///api/recipes?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
___________ TestMealSuggestionsAPI.test_suggestions_endpoint_exists ____________

self = <test_iteration12_critical_fixes.TestMealSuggestionsAPI object at 0xfc1e5c80bdd0>

    def test_suggestions_endpoint_exists(self):
        """Test that suggestions endpoint exists"""
>       response = requests.get(f"{BASE_URL}/api/suggestions/meals")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration12_critical_fixes.py:161: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:73: in get
    return request("get", url, params=params, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/suggestions/meals'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/suggestions/meals': No scheme supplied. Perhaps you meant https:///api/suggestions/meals?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
__________ TestMealSuggestionsAPI.test_suggestions_response_structure __________

self = <test_iteration12_critical_fixes.TestMealSuggestionsAPI object at 0xfc1e5c80a310>

    def test_suggestions_response_structure(self):
        """Test suggestions response structure"""
>       response = requests.get(f"{BASE_URL}/api/suggestions/meals")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration12_critical_fixes.py:167: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:73: in get
    return request("get", url, params=params, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/suggestions/meals'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/suggestions/meals': No scheme supplied. Perhaps you meant https:///api/suggestions/meals?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
__________________ TestHealthEndpoint.test_api_root_endpoint ___________________

self = <test_iteration12_critical_fixes.TestHealthEndpoint object at 0xfc1e5c6c92d0>

    def test_api_root_endpoint(self):
        """Test API root endpoint returns OK"""
>       response = requests.get(f"{BASE_URL}/api/")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_iteration12_critical_fixes.py:180: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:73: in get
    return request("get", url, params=params, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/': No scheme supplied. Perhaps you meant https:///api/?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
___________ TestPantryAlerts.test_add_pantry_item_with_min_threshold ___________

self = <test_pantry_features.TestPantryAlerts object at 0xfc1e5c6a8d50>

    def test_add_pantry_item_with_min_threshold(self):
        """Test adding a pantry item with min_threshold (alert threshold)"""
        # Add item with alert threshold
>       response = requests.post(
            f"{BASE_URL}/api/pantry/items",
            headers=self.headers,
            json={
                "name": "Test Eggs",
                "quantity": 12,
                "unit": "eggs",
                "category": "dairy",
                "min_threshold": 3,
                "typical_purchase": 12
            }
        )

backend/tests/test_pantry_features.py:28: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:115: in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/pantry/items'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/pantry/items': No scheme supplied. Perhaps you meant https:///api/pantry/items?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
____________ TestPantryAlerts.test_update_pantry_item_min_threshold ____________

self = <test_pantry_features.TestPantryAlerts object at 0xfc1e5c6a9750>

    def test_update_pantry_item_min_threshold(self):
        """Test updating min_threshold on an existing pantry item"""
        # First, get the pantry to find an item
>       pantry_response = requests.get(
            f"{BASE_URL}/api/pantry",
            headers=self.headers
        )

backend/tests/test_pantry_features.py:72: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:73: in get
    return request("get", url, params=params, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/pantry', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/pantry': No scheme supplied. Perhaps you meant https:///api/pantry?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
__________ TestPantryAlerts.test_add_pantry_item_with_zero_threshold ___________

self = <test_pantry_features.TestPantryAlerts object at 0xfc1e5c6a9e50>

    def test_add_pantry_item_with_zero_threshold(self):
        """Test adding item with zero threshold (no alert)"""
>       response = requests.post(
            f"{BASE_URL}/api/pantry/items",
            headers=self.headers,
            json={
                "name": "Test Bread",
                "quantity": 1,
                "unit": "loaf",
                "category": "grains",
                "min_threshold": 0,
                "typical_purchase": 1
            }
        )

backend/tests/test_pantry_features.py:111: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:115: in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/pantry/items'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/pantry/items': No scheme supplied. Perhaps you meant https:///api/pantry/items?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
____ TestParseIngredients.test_parse_ingredients_with_separate_instructions ____

self = <test_pantry_features.TestParseIngredients object at 0xfc1e5c6aa610>

    def test_parse_ingredients_with_separate_instructions(self):
        """Test that parse-ingredients accepts separate ingredients_text and instructions_text"""
>       response = requests.post(
            f"{BASE_URL}/api/parse-ingredients",
            headers=self.headers,
            json={
                "recipe_name": "Test Chicken Recipe",
                "ingredients_text": "2 chicken breasts\n1 tbsp olive oil\n3 cloves garlic",
                "instructions_text": "1. Preheat oven to 200C\n2. Season chicken\n3. Cook for 25 minutes"
            }
        )

backend/tests/test_pantry_features.py:142: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:115: in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/parse-ingredients'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/parse-ingredients': No scheme supplied. Perhaps you meant https:///api/parse-ingredients?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_______ TestParseIngredients.test_parse_ingredients_without_instructions _______

self = <test_pantry_features.TestParseIngredients object at 0xfc1e5c6ab410>

    def test_parse_ingredients_without_instructions(self):
        """Test that parse-ingredients works with only ingredients_text"""
>       response = requests.post(
            f"{BASE_URL}/api/parse-ingredients",
            headers=self.headers,
            json={
                "recipe_name": "Simple Recipe",
                "ingredients_text": "2 cups flour\n1 cup sugar\n2 eggs",
                "instructions_text": ""
            }
        )

backend/tests/test_pantry_features.py:165: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:115: in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/parse-ingredients'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/parse-ingredients': No scheme supplied. Perhaps you meant https:///api/parse-ingredients?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_____________________ TestPantryEndpoints.test_get_pantry ______________________

self = <test_pantry_features.TestPantryEndpoints object at 0xfc1e5c6ab6d0>

    def test_get_pantry(self):
        """Test getting pantry"""
>       response = requests.get(
            f"{BASE_URL}/api/pantry",
            headers=self.headers
        )

backend/tests/test_pantry_features.py:196: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:73: in get
    return request("get", url, params=params, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/pantry', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/pantry': No scheme supplied. Perhaps you meant https:///api/pantry?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_____________ TestPantryEndpoints.test_add_and_delete_pantry_item ______________

self = <test_pantry_features.TestPantryEndpoints object at 0xfc1e5c6abf90>

    def test_add_and_delete_pantry_item(self):
        """Test adding and deleting a pantry item"""
        # Add item
>       add_response = requests.post(
            f"{BASE_URL}/api/pantry/items",
            headers=self.headers,
            json={
                "name": "TEST_Delete_Item",
                "quantity": 1,
                "unit": "piece",
                "category": "other",
                "min_threshold": 0,
                "typical_purchase": 1
            }
        )

backend/tests/test_pantry_features.py:209: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:115: in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/pantry/items'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/pantry/items': No scheme supplied. Perhaps you meant https:///api/pantry/items?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
____________________ TestHealthCheck.test_api_root_endpoint ____________________

self = <test_pantry_features.TestHealthCheck object at 0xfc1e5c6be810>

    def test_api_root_endpoint(self):
        """Test /api/ root endpoint"""
>       response = requests.get(f"{BASE_URL}/api/")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_pantry_features.py:250: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:73: in get
    return request("get", url, params=params, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/': No scheme supplied. Perhaps you meant https:///api/?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_________ TestParseImageEndpoint.test_parse_image_extracts_ingredients _________

self = <test_parse_image.TestParseImageEndpoint object at 0xfc1e5c67d3d0>
test_image_with_ingredients = <_io.BytesIO object at 0xfc1e5c6b7a10>

    def test_parse_image_extracts_ingredients(self, test_image_with_ingredients):
        """Test that the API extracts ingredients from an image with text"""
        files = {'file': ('test_ingredients.png', test_image_with_ingredients, 'image/png')}
    
>       response = requests.post(f"{BASE_URL}/api/parse-image", files=files, timeout=60)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_parse_image.py:49: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:115: in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/parse-image'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/parse-image': No scheme supplied. Perhaps you meant https:///api/parse-image?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
___________ TestParseImageEndpoint.test_parse_image_returns_raw_text ___________

self = <test_parse_image.TestParseImageEndpoint object at 0xfc1e5c67e5d0>
test_image_with_ingredients = <_io.BytesIO object at 0xfc1e5b8e7330>

    def test_parse_image_returns_raw_text(self, test_image_with_ingredients):
        """Test that the API returns the raw extracted text"""
        files = {'file': ('test_ingredients.png', test_image_with_ingredients, 'image/png')}
    
>       response = requests.post(f"{BASE_URL}/api/parse-image", files=files, timeout=60)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_parse_image.py:83: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:115: in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/parse-image'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/parse-image': No scheme supplied. Perhaps you meant https:///api/parse-image?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_________ TestParseImageEndpoint.test_parse_image_handles_blank_image __________

self = <test_parse_image.TestParseImageEndpoint object at 0xfc1e5c67e910>
blank_image = <_io.BytesIO object at 0xfc1e5b8e7240>

    def test_parse_image_handles_blank_image(self, blank_image):
        """Test that the API handles images with no text gracefully"""
        files = {'file': ('blank.png', blank_image, 'image/png')}
    
>       response = requests.post(f"{BASE_URL}/api/parse-image", files=files, timeout=60)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_parse_image.py:98: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:115: in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/parse-image'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/parse-image': No scheme supplied. Perhaps you meant https:///api/parse-image?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
____________ TestParseImageEndpoint.test_parse_image_requires_file _____________

self = <test_parse_image.TestParseImageEndpoint object at 0xfc1e5c67f110>

    def test_parse_image_requires_file(self):
        """Test that the API returns error when no file is provided"""
>       response = requests.post(f"{BASE_URL}/api/parse-image", timeout=30)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_parse_image.py:110: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:115: in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>, url = '/api/parse-image'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/parse-image': No scheme supplied. Perhaps you meant https:///api/parse-image?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_________________________ TestAPIHealth.test_api_root __________________________

self = <test_parse_image.TestAPIHealth object at 0xfc1e5c67fb50>

    def test_api_root(self):
        """Test that the API root endpoint is accessible"""
>       response = requests.get(f"{BASE_URL}/api/", timeout=10)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_parse_image.py:122: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:73: in get
    return request("get", url, params=params, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/': No scheme supplied. Perhaps you meant https:///api/?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_____________________ TestAPIHealth.test_recipes_endpoint ______________________

self = <test_parse_image.TestAPIHealth object at 0xfc1e5c6f5450>

    def test_recipes_endpoint(self):
        """Test that recipes endpoint is accessible"""
>       response = requests.get(f"{BASE_URL}/api/recipes", timeout=10)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_parse_image.py:130: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/api.py:73: in get
    return request("get", url, params=params, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/recipes', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes': No scheme supplied. Perhaps you meant https:///api/recipes?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_______ TestCORSAndAuth.test_auth_me_returns_200_for_authenticated_user ________

self = <test_reviews_and_sorting.TestCORSAndAuth object at 0xfc1e5c6f79d0>
api_client = <requests.sessions.Session object at 0xfc1e5b818c90>

    def test_auth_me_returns_200_for_authenticated_user(self, api_client):
        """CORS fix - verify /api/auth/me returns 200 (not 401) for authenticated users"""
>       response = api_client.get(f"{BASE_URL}/api/auth/me")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_reviews_and_sorting.py:48: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/auth/me', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/auth/me': No scheme supplied. Perhaps you meant https:///api/auth/me?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
______ TestCORSAndAuth.test_auth_me_returns_401_for_unauthenticated_user _______

self = <test_reviews_and_sorting.TestCORSAndAuth object at 0xfc1e5c67e110>
unauthenticated_client = <requests.sessions.Session object at 0xfc1e5b8c9510>

    def test_auth_me_returns_401_for_unauthenticated_user(self, unauthenticated_client):
        """Verify unauthenticated requests get 401"""
>       response = unauthenticated_client.get(f"{BASE_URL}/api/auth/me")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_reviews_and_sorting.py:59: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/auth/me', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/auth/me': No scheme supplied. Perhaps you meant https:///api/auth/me?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_______________ TestRecipesSorting.test_get_recipes_default_sort _______________

self = <test_reviews_and_sorting.TestRecipesSorting object at 0xfc1e5c6f4650>
unauthenticated_client = <requests.sessions.Session object at 0xfc1e5c80b5d0>

    def test_get_recipes_default_sort(self, unauthenticated_client):
        """GET /api/recipes without sort_by returns recipes"""
>       response = unauthenticated_client.get(f"{BASE_URL}/api/recipes")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_reviews_and_sorting.py:68: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/recipes', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes': No scheme supplied. Perhaps you meant https:///api/recipes?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
____________ TestRecipesSorting.test_get_recipes_sort_by_popularity ____________

self = <test_reviews_and_sorting.TestRecipesSorting object at 0xfc1e5c6f4310>
unauthenticated_client = <requests.sessions.Session object at 0xfc1e5b9e5a90>

    def test_get_recipes_sort_by_popularity(self, unauthenticated_client):
        """GET /api/recipes?sort_by=popularity returns recipes sorted by rating"""
>       response = unauthenticated_client.get(f"{BASE_URL}/api/recipes?sort_by=popularity")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_reviews_and_sorting.py:75: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/recipes?sort_by=popularity'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes?sort_by=popularity': No scheme supplied. Perhaps you meant https:///api/recipes?sort_by=popularity?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
______________ TestRecipesSorting.test_get_recipes_sort_by_newest ______________

self = <test_reviews_and_sorting.TestRecipesSorting object at 0xfc1e5c6f4590>
unauthenticated_client = <requests.sessions.Session object at 0xfc1e5b9bd350>

    def test_get_recipes_sort_by_newest(self, unauthenticated_client):
        """GET /api/recipes?sort_by=newest returns recipes sorted by created_at"""
>       response = unauthenticated_client.get(f"{BASE_URL}/api/recipes?sort_by=newest")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_reviews_and_sorting.py:90: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/recipes?sort_by=newest'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes?sort_by=newest': No scheme supplied. Perhaps you meant https:///api/recipes?sort_by=newest?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_________________ TestReviewsCRUD.test_get_reviews_for_recipe __________________

self = <test_reviews_and_sorting.TestReviewsCRUD object at 0xfc1e5c6f4f10>
unauthenticated_client = <requests.sessions.Session object at 0xfc1e5b861b10>

    def test_get_reviews_for_recipe(self, unauthenticated_client):
        """GET /api/recipes/{recipe_id}/reviews returns reviews"""
>       response = unauthenticated_client.get(f"{BASE_URL}/api/recipes/{TEST_RECIPE_ID}/reviews")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_reviews_and_sorting.py:101: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>
url = '/api/recipes/3c4acbd9-3b36-45cf-b8fc-8ac49fcbf520/reviews'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes/3c4acbd9-3b36-45cf-b8fc-8ac49fcbf520/reviews': No scheme supplied. Perhaps you meant https:///api/recipes/3c4acbd9-3b36-45cf-b8fc-8ac49fcbf520/reviews?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
__________________ TestReviewsCRUD.test_add_review_to_recipe ___________________

self = <test_reviews_and_sorting.TestReviewsCRUD object at 0xfc1e5c724a10>
api_client = <requests.sessions.Session object at 0xfc1e5c6c8f10>

    def test_add_review_to_recipe(self, api_client):
        """POST /api/recipes/{recipe_id}/reviews adds a review"""
        review_data = {
            "rating": 5,
            "comment": "Test review from pytest - excellent recipe!"
        }
>       response = api_client.post(
            f"{BASE_URL}/api/recipes/{TEST_RECIPE_ID}/reviews",
            json=review_data
        )

backend/tests/test_reviews_and_sorting.py:116: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:637: in post
    return self.request("POST", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>
url = '/api/recipes/3c4acbd9-3b36-45cf-b8fc-8ac49fcbf520/reviews'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes/3c4acbd9-3b36-45cf-b8fc-8ac49fcbf520/reviews': No scheme supplied. Perhaps you meant https:///api/recipes/3c4acbd9-3b36-45cf-b8fc-8ac49fcbf520/reviews?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
________ TestReviewsCRUD.test_add_review_updates_recipe_average_rating _________

self = <test_reviews_and_sorting.TestReviewsCRUD object at 0xfc1e5c725090>
api_client = <requests.sessions.Session object at 0xfc1e5b9c8050>
unauthenticated_client = <requests.sessions.Session object at 0xfc1e5b887010>

    def test_add_review_updates_recipe_average_rating(self, api_client, unauthenticated_client):
        """Adding a review updates the recipe's average_rating and review_count"""
        # Get current recipe state
>       recipe_response = unauthenticated_client.get(f"{BASE_URL}/api/recipes/{TEST_RECIPE_ID}")
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_reviews_and_sorting.py:133: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>
url = '/api/recipes/3c4acbd9-3b36-45cf-b8fc-8ac49fcbf520'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes/3c4acbd9-3b36-45cf-b8fc-8ac49fcbf520': No scheme supplied. Perhaps you meant https:///api/recipes/3c4acbd9-3b36-45cf-b8fc-8ac49fcbf520?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_______________ TestReviewsCRUD.test_add_review_without_comment ________________

self = <test_reviews_and_sorting.TestReviewsCRUD object at 0xfc1e5c725750>
api_client = <requests.sessions.Session object at 0xfc1e5b863490>

    def test_add_review_without_comment(self, api_client):
        """POST review with rating only (no comment) works"""
        review_data = {"rating": 4, "comment": ""}
>       response = api_client.post(
            f"{BASE_URL}/api/recipes/{TEST_RECIPE_ID}/reviews",
            json=review_data
        )

backend/tests/test_reviews_and_sorting.py:157: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:637: in post
    return self.request("POST", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>
url = '/api/recipes/3c4acbd9-3b36-45cf-b8fc-8ac49fcbf520/reviews'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes/3c4acbd9-3b36-45cf-b8fc-8ac49fcbf520/reviews': No scheme supplied. Perhaps you meant https:///api/recipes/3c4acbd9-3b36-45cf-b8fc-8ac49fcbf520/reviews?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
________________ TestReviewsCRUD.test_add_review_invalid_rating ________________

self = <test_reviews_and_sorting.TestReviewsCRUD object at 0xfc1e5c725dd0>
api_client = <requests.sessions.Session object at 0xfc1e5b9fdcd0>

    def test_add_review_invalid_rating(self, api_client):
        """POST review with invalid rating fails validation"""
        # Rating must be 1-5
        review_data = {"rating": 0, "comment": "Invalid"}
>       response = api_client.post(
            f"{BASE_URL}/api/recipes/{TEST_RECIPE_ID}/reviews",
            json=review_data
        )

backend/tests/test_reviews_and_sorting.py:170: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:637: in post
    return self.request("POST", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>
url = '/api/recipes/3c4acbd9-3b36-45cf-b8fc-8ac49fcbf520/reviews'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes/3c4acbd9-3b36-45cf-b8fc-8ac49fcbf520/reviews': No scheme supplied. Perhaps you meant https:///api/recipes/3c4acbd9-3b36-45cf-b8fc-8ac49fcbf520/reviews?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
____________ TestReviewsCRUD.test_add_review_to_nonexistent_recipe _____________

self = <test_reviews_and_sorting.TestReviewsCRUD object at 0xfc1e5c7264d0>
api_client = <requests.sessions.Session object at 0xfc1e5b88e990>

    def test_add_review_to_nonexistent_recipe(self, api_client):
        """POST review to non-existent recipe returns 404"""
        review_data = {"rating": 5, "comment": "Test"}
>       response = api_client.post(
            f"{BASE_URL}/api/recipes/nonexistent-recipe-id/reviews",
            json=review_data
        )

backend/tests/test_reviews_and_sorting.py:180: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:637: in post
    return self.request("POST", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [POST]>
url = '/api/recipes/nonexistent-recipe-id/reviews', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes/nonexistent-recipe-id/reviews': No scheme supplied. Perhaps you meant https:///api/recipes/nonexistent-recipe-id/reviews?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
___________ TestReviewsCRUD.test_get_reviews_for_nonexistent_recipe ____________

self = <test_reviews_and_sorting.TestReviewsCRUD object at 0xfc1e5c726c10>
unauthenticated_client = <requests.sessions.Session object at 0xfc1e5b818a50>

    def test_get_reviews_for_nonexistent_recipe(self, unauthenticated_client):
        """GET reviews for non-existent recipe returns empty list"""
>       response = unauthenticated_client.get(f"{BASE_URL}/api/recipes/nonexistent-recipe-id/reviews")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_reviews_and_sorting.py:188: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>
url = '/api/recipes/nonexistent-recipe-id/reviews', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes/nonexistent-recipe-id/reviews': No scheme supplied. Perhaps you meant https:///api/recipes/nonexistent-recipe-id/reviews?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_____________ TestRecipeRatingFields.test_recipe_has_rating_fields _____________

self = <test_reviews_and_sorting.TestRecipeRatingFields object at 0xfc1e5c7274d0>
unauthenticated_client = <requests.sessions.Session object at 0xfc1e5b863710>

    def test_recipe_has_rating_fields(self, unauthenticated_client):
        """Verify recipe response includes average_rating and review_count"""
>       response = unauthenticated_client.get(f"{BASE_URL}/api/recipes/{TEST_RECIPE_ID}")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_reviews_and_sorting.py:201: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>
url = '/api/recipes/3c4acbd9-3b36-45cf-b8fc-8ac49fcbf520'
params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes/3c4acbd9-3b36-45cf-b8fc-8ac49fcbf520': No scheme supplied. Perhaps you meant https:///api/recipes/3c4acbd9-3b36-45cf-b8fc-8ac49fcbf520?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
_______ TestRecipeRatingFields.test_recipes_list_includes_rating_fields ________

self = <test_reviews_and_sorting.TestRecipeRatingFields object at 0xfc1e5c727bd0>
unauthenticated_client = <requests.sessions.Session object at 0xfc1e5b88c3d0>

    def test_recipes_list_includes_rating_fields(self, unauthenticated_client):
        """Verify recipes list includes rating fields for card display"""
>       response = unauthenticated_client.get(f"{BASE_URL}/api/recipes")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend/tests/test_reviews_and_sorting.py:210: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <PreparedRequest [GET]>, url = '/api/recipes', params = OrderedDict()

    def prepare_url(self, url, params):
        """Prepares the given HTTP URL."""
        #: Accept objects that have string representations.
        #: We're unable to blindly call unicode/str functions
        #: as this will include the bytestring indicator (b'')
        #: on python 3.x.
        #: https://github.com/psf/requests/pull/2238
        if isinstance(url, bytes):
            url = url.decode("utf8")
        else:
            url = str(url)
    
        # Remove leading whitespaces from url
        url = url.lstrip()
    
        # Don't do any URL preparation for non-HTTP schemes like `mailto`,
        # `data` etc to work around exceptions from `url_parse`, which
        # handles RFC 3986 only.
        if ":" in url and not url.lower().startswith("http"):
            self.url = url
            return
    
        # Support for unicode domain names and paths.
        try:
            scheme, auth, host, port, path, query, fragment = parse_url(url)
        except LocationParseError as e:
            raise InvalidURL(*e.args)
    
        if not scheme:
>           raise MissingSchema(
                f"Invalid URL {url!r}: No scheme supplied. "
                f"Perhaps you meant https://{url}?"
            )
E           requests.exceptions.MissingSchema: Invalid URL '/api/recipes': No scheme supplied. Perhaps you meant https:///api/recipes?

/root/.venv/lib/python3.11/site-packages/requests/models.py:438: MissingSchema
________ TestShareCreation.test_share_creates_token_or_compliance_fails ________

self = <test_share_feature.TestShareCreation object at 0xfc1e5ba33250>
test_user1 = {'token': 'test_share_session1_1770824197278', 'user_id': 'test-share-user1-1770824197278'}
test_recipe = {'average_rating': 0.0, 'categories': ['vegan', 'quick-easy'], 'cook_time': '0 min', 'created_at': '2026-02-11T15:36:37.795433Z', ...}

    def test_share_creates_token_or_compliance_fails(self, test_user1, test_recipe):
        """POST /api/recipes/share should create a token or fail compliance"""
        if not test_user1 or not test_recipe:
            pytest.skip("Test setup failed")
    
        response = requests.post(
            f"{BASE_URL}/api/recipes/share",
            headers={"Authorization": f"Bearer {test_user1['token']}", "Content-Type": "application/json"},
            json={"recipe_ids": [test_recipe['id']]}
        )
    
        # May fail due to compliance - that's expected behavior
        if response.status_code == 400:
            data = response.json()
            if "compliance" in data.get("detail", "").lower() or "could not generate" in data.get("detail", "").lower():
                print(" Share correctly rejected due to compliance check (AI rewrite didn't pass n-gram check)")
                return
    
>       assert response.status_code == 200, f"Expected 200, got {response.status_code}: {response.text}"
E       AssertionError: Expected 200, got 400: {"detail":"No recipes could be prepared for sharing. Issues: Error processing 'Test Simple Salad'"}
E       assert 400 == 200
E        +  where 400 = <Response [400]>.status_code

backend/tests/test_share_feature.py:240: AssertionError
=============================== warnings summary ===============================
backend/tests/test_expiry_features.py::TestPantryExpiryFeatures::test_add_pantry_item_with_expiry_date
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:170: PytestReturnNotNoneWarning: Test functions should return None, but backend/tests/test_expiry_features.py::TestPantryExpiryFeatures::test_add_pantry_item_with_expiry_date returned <class 'str'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend/tests/test_expiry_features.py::TestPantryExpiryFeatures::test_add_pantry_item_expired
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:170: PytestReturnNotNoneWarning: Test functions should return None, but backend/tests/test_expiry_features.py::TestPantryExpiryFeatures::test_add_pantry_item_expired returned <class 'str'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend/tests/test_expiry_features.py::TestPantryExpiryFeatures::test_add_pantry_item_expiring_in_7_days
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:170: PytestReturnNotNoneWarning: Test functions should return None, but backend/tests/test_expiry_features.py::TestPantryExpiryFeatures::test_add_pantry_item_expiring_in_7_days returned <class 'str'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend/tests/test_expiry_features.py::TestPantryExpiryFeatures::test_update_pantry_item_expiry_date
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:170: PytestReturnNotNoneWarning: Test functions should return None, but backend/tests/test_expiry_features.py::TestPantryExpiryFeatures::test_update_pantry_item_expiry_date returned <class 'str'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend/tests/test_expiry_features.py::TestPantryExpiryFeatures::test_remove_pantry_item_expiry_date
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:170: PytestReturnNotNoneWarning: Test functions should return None, but backend/tests/test_expiry_features.py::TestPantryExpiryFeatures::test_remove_pantry_item_expiry_date returned <class 'str'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED backend/tests/test_expiry_receipt.py::TestReceiptScanning::test_scan_receipt_endpoint_exists
FAILED backend/tests/test_features_iteration5.py::TestRecipeCategoriesAPI::test_create_recipe_with_categories
FAILED backend/tests/test_features_iteration5.py::TestRecipeCategoriesAPI::test_update_recipe_categories
FAILED backend/tests/test_features_iteration5.py::TestRecipeCategoriesAPI::test_update_categories_remove_all
FAILED backend/tests/test_features_iteration5.py::TestRecipeCategoriesAPI::test_update_categories_invalid_recipe
FAILED backend/tests/test_features_iteration5.py::TestPantryCookAPI::test_cook_recipe_deducts_pantry
FAILED backend/tests/test_features_iteration5.py::TestPantryCookAPI::test_cook_recipe_with_missing_ingredients
FAILED backend/tests/test_features_iteration5.py::TestPantryCookAPI::test_cook_recipe_not_found
FAILED backend/tests/test_features_iteration5.py::TestPantryCookAPI::test_cook_recipe_with_servings_multiplier
FAILED backend/tests/test_features_iteration5.py::TestRecipeFilterByCategory::test_recipes_have_categories_field
FAILED backend/tests/test_features_iteration5.py::TestRecipeFilterByCategory::test_create_recipes_with_different_categories
FAILED backend/tests/test_iteration11_features.py::TestAuthAndBasicEndpoints::test_auth_me
FAILED backend/tests/test_iteration11_features.py::TestAuthAndBasicEndpoints::test_api_root
FAILED backend/tests/test_iteration11_features.py::TestMealSuggestionsRelatedRecipeCount::test_suggestions_endpoint_returns_related_recipe_count
FAILED backend/tests/test_iteration11_features.py::TestMealSuggestionsRelatedRecipeCount::test_suggestions_with_expiring_filter
FAILED backend/tests/test_iteration11_features.py::TestRecipeCreationWithImageChoice::test_create_recipe_with_ai_image
FAILED backend/tests/test_iteration11_features.py::TestRecipeCreationWithImageChoice::test_create_recipe_with_no_image
FAILED backend/tests/test_iteration11_features.py::TestRecipeCreationWithImageChoice::test_create_recipe_with_own_base64_image
FAILED backend/tests/test_iteration11_features.py::TestWeeklyPlannerSuggestions::test_get_recipes_grouped
FAILED backend/tests/test_iteration11_features.py::TestWeeklyPlannerSuggestions::test_weekly_plan_crud
FAILED backend/tests/test_iteration11_features.py::TestRecipeLibraryImages::test_get_recipes_returns_image_urls
FAILED backend/tests/test_iteration11_features.py::TestPantryExpiringItems::test_get_expiring_soon
FAILED backend/tests/test_iteration11_features.py::TestPantryExpiringItems::test_add_pantry_item_with_expiry
FAILED backend/tests/test_iteration11_features.py::TestRecipeImportImageConversion::test_scrape_recipe_url_endpoint
FAILED backend/tests/test_iteration11_features.py::TestCompositeScoreCalculation::test_suggestions_have_composite_score
FAILED backend/tests/test_iteration12_critical_fixes.py::TestRecipeGroupingAPI::test_recipes_grouped_endpoint_exists
FAILED backend/tests/test_iteration12_critical_fixes.py::TestRecipeGroupingAPI::test_recipes_grouped_response_structure
FAILED backend/tests/test_iteration12_critical_fixes.py::TestRecipeGroupingAPI::test_recipes_grouped_count_field
FAILED backend/tests/test_iteration12_critical_fixes.py::TestRecipeGroupingAPI::test_recipes_grouped_recipe_structure
FAILED backend/tests/test_iteration12_critical_fixes.py::TestRecipeCreationWithImageChoice::test_create_recipe_with_ai_image
FAILED backend/tests/test_iteration12_critical_fixes.py::TestRecipeCreationWithImageChoice::test_create_recipe_without_image
FAILED backend/tests/test_iteration12_critical_fixes.py::TestRecipeCreationWithImageChoice::test_create_recipe_with_own_image
FAILED backend/tests/test_iteration12_critical_fixes.py::TestMealSuggestionsAPI::test_suggestions_endpoint_exists
FAILED backend/tests/test_iteration12_critical_fixes.py::TestMealSuggestionsAPI::test_suggestions_response_structure
FAILED backend/tests/test_iteration12_critical_fixes.py::TestHealthEndpoint::test_api_root_endpoint
FAILED backend/tests/test_pantry_features.py::TestPantryAlerts::test_add_pantry_item_with_min_threshold
FAILED backend/tests/test_pantry_features.py::TestPantryAlerts::test_update_pantry_item_min_threshold
FAILED backend/tests/test_pantry_features.py::TestPantryAlerts::test_add_pantry_item_with_zero_threshold
FAILED backend/tests/test_pantry_features.py::TestParseIngredients::test_parse_ingredients_with_separate_instructions
FAILED backend/tests/test_pantry_features.py::TestParseIngredients::test_parse_ingredients_without_instructions
FAILED backend/tests/test_pantry_features.py::TestPantryEndpoints::test_get_pantry
FAILED backend/tests/test_pantry_features.py::TestPantryEndpoints::test_add_and_delete_pantry_item
FAILED backend/tests/test_pantry_features.py::TestHealthCheck::test_api_root_endpoint
FAILED backend/tests/test_parse_image.py::TestParseImageEndpoint::test_parse_image_extracts_ingredients
FAILED backend/tests/test_parse_image.py::TestParseImageEndpoint::test_parse_image_returns_raw_text
FAILED backend/tests/test_parse_image.py::TestParseImageEndpoint::test_parse_image_handles_blank_image
FAILED backend/tests/test_parse_image.py::TestParseImageEndpoint::test_parse_image_requires_file
FAILED backend/tests/test_parse_image.py::TestAPIHealth::test_api_root - requ...
FAILED backend/tests/test_parse_image.py::TestAPIHealth::test_recipes_endpoint
FAILED backend/tests/test_reviews_and_sorting.py::TestCORSAndAuth::test_auth_me_returns_200_for_authenticated_user
FAILED backend/tests/test_reviews_and_sorting.py::TestCORSAndAuth::test_auth_me_returns_401_for_unauthenticated_user
FAILED backend/tests/test_reviews_and_sorting.py::TestRecipesSorting::test_get_recipes_default_sort
FAILED backend/tests/test_reviews_and_sorting.py::TestRecipesSorting::test_get_recipes_sort_by_popularity
FAILED backend/tests/test_reviews_and_sorting.py::TestRecipesSorting::test_get_recipes_sort_by_newest
FAILED backend/tests/test_reviews_and_sorting.py::TestReviewsCRUD::test_get_reviews_for_recipe
FAILED backend/tests/test_reviews_and_sorting.py::TestReviewsCRUD::test_add_review_to_recipe
FAILED backend/tests/test_reviews_and_sorting.py::TestReviewsCRUD::test_add_review_updates_recipe_average_rating
FAILED backend/tests/test_reviews_and_sorting.py::TestReviewsCRUD::test_add_review_without_comment
FAILED backend/tests/test_reviews_and_sorting.py::TestReviewsCRUD::test_add_review_invalid_rating
FAILED backend/tests/test_reviews_and_sorting.py::TestReviewsCRUD::test_add_review_to_nonexistent_recipe
FAILED backend/tests/test_reviews_and_sorting.py::TestReviewsCRUD::test_get_reviews_for_nonexistent_recipe
FAILED backend/tests/test_reviews_and_sorting.py::TestRecipeRatingFields::test_recipe_has_rating_fields
FAILED backend/tests/test_reviews_and_sorting.py::TestRecipeRatingFields::test_recipes_list_includes_rating_fields
FAILED backend/tests/test_share_feature.py::TestShareCreation::test_share_creates_token_or_compliance_fails
================== 64 failed, 33 passed, 5 warnings in 9.39s ===================) have been created, increasing regression risk.</analysis>
